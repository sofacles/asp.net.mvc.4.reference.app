@using BikeStore.Models;
@using DAL;

@model ProductListViewModel

@{
	
	ViewBag.Title = "Products";
}


	
    <div class="product-list container">
        @foreach (Product product in Model.Products)
		{
			<section class="cell col-xs-12 col-sm-4 col-md-4 col-lg-3">
				<header>
					<h2> @product.name</h2>
					<div class="product-name"> @product.description </div> 
					<!-- TODO: increment quantity -->
				</header>
				<footer>
					<span class="price">@product.price</span>
					<input type="button" class="btn btn-success" value="add to cart" onclick="addToCart('@product.id')" />
				</footer>
				
			</section>
		}
    </div>
	<div class="checkout-container"></div> 



<script type="text/javascript">

	var orderID = '@Model.OrderID';
	
	function addToCart(productID)
	{
		$.ajax({
			type: "POST",
			url: '@Url.Content("~/Order/AddProductToOrder")',
			data: { productID: productID,
				orderID: orderID,
				OrderExists: false
			},
			success: function (data)
			{
				var oldHref;
				if (orderID == -1)
				{
					orderID = data.ordID;
					oldHref = $(".cartLink").attr("href");
					$(".cartLink").attr("href", oldHref.substring(0, oldHref.indexOf("?")) + "?orderID=" + orderID);
				}
			}
		});
		
	}
</script>

